# HSDK Polyfills

A set of polyfills and a script to detect what features are supported natively by the WebView. 

Based on this detection Mobile SDK includes polyfills for features that are not supported natively.


<a name="package-information"></a>
## Package information
| Parameter             | Value                       |
|:----------------------|:----------------------------|
| Name                  | @backbase/hsdk-polyfills    |
| Version               | 1.10.0                      |


<a name="package-content-size"></a>
## Content size
| File                                     | Size                 |
|:-----------------------------------------|:---------------------|
| es5/core-js.js                           | 134.65 kB            |
| es5/web-components.js                    | 88.20 kB             |
| es5/intl.js                              | 58.46 kB             |
| es5/dom4.js                              | 3.34 kB              |
| es5/detect-browser-features-support.js   | 1.27 kB              |
| es5/web-components-native-shim.js        | 1.22 kB              |


## List of polyfills

| Polyfill                 | Description                | Required in                 |
|:-------------------------|:---------------------------|:----------------------------|
| core-js                  | ES2017 language features   | Android WebView v33–54      |
| web-components           | Web Components             | Android WebView v33–53      |
| intl                     | Intl specification         | iOS 9 only                  |
| dom4                     | Modern DOM API             | Android WebView v33–53      |


#### Web components
The polyfill for web components includes Custom Elements, Shadow DOM, Shady CSS,
and HTML Content Templates.


#### DOM4
The dom4 polyfill includes the following DOM APIs:

- _Element.prototype.classList_
- _Element.prototype.getRootNode()_
- _Event.composedPath_

We need to investigate what other features are not supported in the target platforms.


#### Fix transpiled classes
The Custom Elements specification is not compatible with ES5 style classes.
This means ES2015 code compiled to ES5 will not work with a native implementation of Custom Elements.

-- <cite>[https://github.com/webcomponents/custom-elements#es5-vs-es2015]()</cite>

In real world we have to use transpiled ES5 code to make sure we are compatible
with old WebViews. To solve the issue with transpiled ES2015 classes the Mobile SDK
always includes a small (1.62 KB) **web-components-native-shim.js** file
that patches the _window.HTMLElement_ constructor in the way, so custom elements
can work with ES5 style classes.   


#### NOTE: Partial feature support
Currently we use a naive way to detect features support.
We only test whether a particular API available or not. We do not test thoroughly 
if the native implementation supports the latest version of a corresponding specification entirely.

For instance, there are some versions of browsers or WebViews, that do support the _Intl_ specification in general,
but they do not support some particular latest additions to the spec, that were introduced recently.
For these browsers the polyfill _will not_ be added by Mobile SDK automatically.


#### References
- [ES2015 features](https://www.ecma-international.org/ecma-262/6.0/)
- [Web Components](https://developer.mozilla.org/en-US/docs/Web/Web_Components)
- [Intl specification](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [DOM4](https://www.w3.org/TR/dom/) 
