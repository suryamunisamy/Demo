# HSDK Core
HSDK Core is the Web API (JavaScript counterpart) of the Mobile SDK.
The main responsibility of HSDK Core is to provide a bridge
between native and web parts of a hybrid application.

HSDK Core is distributed as part of Mobile SDK and included to a WebView automatically by Mobile SDK.


## Table of contents
* [Package information](#package-information)
* [Content size](#package-content-size)
* [Components](#components)
  * [Config](#config)
  * [Logger](#logger)
  * [Platform bridge](#platform-bridge) 
  * [PubSub](#pubsub) 
  * [Set renderer](#set-renderer) 
* [Compatibility](#compatibility)
* [Polyfills](#polyfills)
* [Technical details](#technical-details)


<a name="package-information"></a>
## Package information
| Parameter                | Value                |
|:-------------------------|:---------------------|
| Name                     | @backbase/hsdk-core  |
| Version                  | 1.10.0               |


<a name="package-content-size"></a>
## Content size
| File                     | Size                 |
|:-------------------------|:---------------------|
| es5/hsdk-core.js         | 19.32 kB             |
| es2015/hsdk-core.js      | 18.07 kB             |


<a name="components"></a>
## Components
HSDK Core includes the following components: 

<a name="config"></a>
#### Config
Provides access to some configuration properties.

- *apiRoot* — URL of the API server
- *contextRoot* — Path to a local directory in the device's filesystem that contains static assets 
- *logLevel* — Log level for both Native and Web loggers.
- *remoteContextRoot* — URL of the remove server that contains static assets


<a name="logger"></a>
#### Logger
Implements functionality to log messages in a certain format with a certain severity level.


<a name="platform-bridge"></a>
#### Platform bridge
Provides a bridge between the native code (Objective-C/Swift on iOS and Java on Android)
and JavaScript running in a WebView. The bridge allows to invoke certain native 
functions from JavaScript and visa versa.


<a name="pubsub"></a>
#### PubSub
Implements the [Publish–subscribe](https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern) mechanism 
which allows to communicate between the native code and JavaScript running in a WebView via events.


<a name="set-renderer"></a>
#### Set renderer
Provides a method `setRenderer()`. This method can be used to declare a JavaScript renderer 
that will render the Web application or a Web widget.  


#### Supported platforms
* Android 4.4 KitKat and higher (WebView v33 and higher)
* iOS 9 and higher (UIWebView)        |


<a name="polyfills"></a>
## Polyfills
HSDK Core distributive package includes a set of polyfills and a script
to detect what features are supported natively by the WebView. 

Based on this detection Mobile SDK includes polyfills for features
that are not supported natively.

| Polyfill                 | Description                | Required in                 | Size        |
|:-------------------------|:---------------------------|:----------------------------|:------------|
| core-js                  | ES2017 language features   | Android WebView v33–54      | 134 kB      |
| web-components           | Web Components             | Android WebView v33–53      | 92.01 kB    |
| intl                     | Intl specification         | iOS 9 only                  | 58.44 kB    |
| dom4                     | Modern DOM API             | Android WebView v33–53      | 3.61 kB     |


#### Web components
The polyfill for web components includes Custom Elements, Shadow DOM, Shady CSS,
and HTML Content Templates.


#### DOM4
The dom4 polyfill includes the following DOM APIs:

- _Element.prototype.classList_
- _Element.prototype.getRootNode()_
- _Event.composedPath_

We need to investigate what other features are not supported in the target platforms.


#### Fix transpiled classes
The Custom Elements specification is not compatible with ES5 style classes.
This means ES2015 code compiled to ES5 will not work with a native implementation of Custom Elements.

-- <cite>[https://github.com/webcomponents/custom-elements#es5-vs-es2015]()</cite>

In real world we have to use transpiled ES5 code to make sure we are compatible
with old WebViews. To solve the issue with transpiled ES2015 classes the Mobile SDK
always includes a small (1.62 KB) **web-components-native-shim.js** file
that patches the _window.HTMLElement_ constructor in the way, so custom elements
can work with ES5 style classes.   


#### NOTE: Partial feature support
Currently we use a naive way to detect features support.
We only test whether a particular API available or not. We do not test thoroughly 
if the native implementation supports the latest version of a corresponding specification entirely.

For instance, there are some versions of browsers or WebViews, that do support the _Intl_ specification in general,
but they do not support some particular latest additions to the spec, that were introduced recently.
For these browsers the polyfill _will not_ be added by Mobile SDK automatically.


#### References
- [ES2015 features](https://www.ecma-international.org/ecma-262/6.0/)
- [Web Components](https://developer.mozilla.org/en-US/docs/Web/Web_Components)
- [Intl specification](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl)
- [DOM4](https://www.w3.org/TR/dom/) 


<a name="technical-details"></a>
## Technical details
Source code of the HSDK Core is written in TypeScript which gets compiled
and bundled to a single JavaScript file by [RollupJS](https://rollupjs.org/guide/en).
The syntax of the distribution package is ECMAScript 2017.

Source code is linted by [TSLint](https://palantir.github.io/tslint/) and 
formatted by [Prettier](https://github.com/prettier/prettier). 
