/**
 * Name: hsdk-renderer-wa3
 * Description: HSDK WA3 Renderer is a renderer specifically designed to render HSDK App Shell with an Angular SPA (Single Page Application) based on WA3 (Widget Architecture 3)
 * Version: 1.10.0
 * SHA-1: 5eb8473a88c23b79fac5ecce583206703798581b
 */
(function(){"use strict";var makeError=function(componentName){return function(message){return new Error("["+componentName+"] "+message)}};var makeTypeError=function(componentName){return function(message){return new Error("["+componentName+"] "+message)}};var createError=makeError("hsdk-renderer-wa3");var createTypeError=makeTypeError("hsdk-renderer-wa3");var globalContext=typeof global!=="undefined"?global:window;var getHSDKCore=function(){return globalContext["hsdk-core"]||globalContext["mobile-sdk-web"]};var getBBNamespace=function(){globalContext.BB=globalContext.BB||{};return globalContext.BB};var isArray=Array.isArray;var isFunction=function(testValue){return typeof testValue==="function"};var isObject=function(testValue){return testValue!==null&&typeof testValue==="object"&&!isArray(testValue)};var createBackbaseConfig=function(mobileConfig){var apiRoot=mobileConfig.apiRoot,portalName=mobileConfig.portalName,staticResourcesRoot=mobileConfig.staticResourcesRoot,version=mobileConfig.version;var cspNonce="";var currentLinkUUID="";var currentLink="";var designmode="false";var locale="";var locales="";var linkRoot="";var pageName="";var userId="";return{apiRoot:apiRoot,staticResourcesRoot:staticResourcesRoot,portalName:portalName,pageName:pageName,designmode:designmode,currentLinkUUID:currentLinkUUID,currentLink:currentLink,locale:locale,locales:locales,linkRoot:linkRoot,cspNonce:cspNonce,userId:userId,version:version}};var __assign=function(){__assign=Object.assign||function __assign(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};return __assign.apply(this,arguments)};var NATIVE_RENDERER_NAME="BBWebAppRenderer";var isWA3Page=function(page){return Boolean(page.preferences&&page.preferences.native===NATIVE_RENDERER_NAME)};var toWA3Item=function(item){return __assign({},item.children?{children:item.children.map((function(child){return toWA3Item(child)}))}:{},{name:item.name,properties:__assign({},item.preferences)})};var getPageModel=function(mbaasPortalModel){return mbaasPortalModel.pages.filter((function(page){return isWA3Page(page)}))[0]};var isPortalModel=function(mbaasModel){return mbaasModel&&{}.hasOwnProperty.call(mbaasModel,"pages")};var toWA3AppModel=function(mbaasPageModel){var appModel=mbaasPageModel.children[0];return{children:appModel.children.map((function(item){return toWA3Item(item)})),name:appModel.name,properties:__assign({},appModel.preferences)}};var documentReady=function(){return new Promise((function(resolve,reject){if(globalContext.document.readyState==="loading"){globalContext.document.addEventListener("DOMContentLoaded",(function(){resolve()}))}else{resolve()}}))};var createMessage=function(errorPrefix,message){return errorPrefix+": Invalid page model: "+message};var pageNotFoundError=function(errorPrefix){return createError(errorPrefix+": Could not find any HSDK pages in the provided portal model. "+"Make sure there is at least one page in the portal that "+("has property native="+NATIVE_RENDERER_NAME+"."))};var throwIfAlreadyTriggered=function(isRenderTriggered){if(isRenderTriggered){throw createError("The renderItem() method must to be called only once. "+"But actually this method has been called by Mobile SDK more than 1 time. "+"Likely there is an issue in native code.")}};var throwIfInvalidMBAASPage=function(errorPrefix,pageModel){if(!isObject(pageModel)){throw createTypeError(createMessage(errorPrefix,"No page model was provided"))}if(!isArray(pageModel.children)){throw createTypeError(createMessage(errorPrefix,"The page model does not have children"))}if(!pageModel.id){throw createTypeError(createMessage(errorPrefix,"The page model does not have a specified id"))}if(!pageModel.name){throw createTypeError(createMessage(errorPrefix,"The page model does not have a specified name"))}if(!isObject(pageModel.preferences)){throw createTypeError(createMessage(errorPrefix,"The page model does not have preferences"))}};var throwIfInvalidWA3Application=function(errorPrefix){if(!isFunction(getBBNamespace().startSingleApp)){throw createError(errorPrefix+': "window.BB.startSingleApp" is not a function')}};var createRenderer=function(mobileConfig){var name="hsdk-renderer-wa3";var isRenderTriggered=false;var bbNamespace=getBBNamespace();var bbConfig=createBackbaseConfig(mobileConfig);bbNamespace.config=bbConfig;var renderItem=function(model){return documentReady().then((function(){var errorPrefix="Unable to start the application";var getPageModelOrThrow=function(portalModel){var page=getPageModel(portalModel);if(!page){throw pageNotFoundError(errorPrefix)}return page};var pageModel=isPortalModel(model)?getPageModelOrThrow(model):model;throwIfInvalidMBAASPage(errorPrefix,pageModel);throwIfInvalidWA3Application(errorPrefix);throwIfAlreadyTriggered(isRenderTriggered);isRenderTriggered=true;bbConfig.locale=pageModel.preferences.locale||"";bbConfig.pageName=pageModel.name;var wa3AppModel=toWA3AppModel(pageModel);return getBBNamespace().startSingleApp().then((function(wa3Application){return wa3Application.bootstrap(wa3AppModel)}))}))};return{name:name,renderItem:renderItem}};var setRenderer=function(){if(!isObject(getHSDKCore())){throw createError("Unable to set the renderer: HSDK Core is not available on the window")}getHSDKCore().setRenderer(createRenderer)};setRenderer()})();
