/**
 * Name: bbxhr
 * Description: A custom implementation of XMLHttpRequest that uses the BBXHR plugin
 * Version: 1.0.0-rc.69
 * SHA-1: d8ec6df9178ca39157b62dd55cd2f61dd2af6b32
 */
(function(exports){"use strict";(function(self){var support={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{new Blob;return true}catch(e){return false}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(support.arrayBuffer){var viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"];var isDataView=function(obj){return obj&&DataView.prototype.isPrototypeOf(obj)};var isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&viewClasses.indexOf(Object.prototype.toString.call(obj))>-1}}function normalizeName(name){if(typeof name!=="string"){name=String(name)}if(/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(name)){throw new TypeError("Invalid character in header field name")}return name.toLowerCase()}function normalizeValue(value){if(typeof value!=="string"){value=String(value)}return value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:value===undefined,value:value}}};if(support.iterable){iterator[Symbol.iterator]=function(){return iterator}}return iterator}function Headers(headers){this.map={};if(headers instanceof Headers){headers.forEach((function(value,name){this.append(name,value)}),this)}else if(Array.isArray(headers)){headers.forEach((function(header){this.append(header[0],header[1])}),this)}else if(headers){Object.getOwnPropertyNames(headers).forEach((function(name){this.append(name,headers[name])}),this)}}Headers.prototype.append=function(name,value){name=normalizeName(name);value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+","+value:value};Headers.prototype["delete"]=function(name){delete this.map[normalizeName(name)]};Headers.prototype.get=function(name){name=normalizeName(name);return this.has(name)?this.map[name]:null};Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))};Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)};Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map){if(this.map.hasOwnProperty(name)){callback.call(thisArg,this.map[name],name,this)}}};Headers.prototype.keys=function(){var items=[];this.forEach((function(value,name){items.push(name)}));return iteratorFor(items)};Headers.prototype.values=function(){var items=[];this.forEach((function(value){items.push(value)}));return iteratorFor(items)};Headers.prototype.entries=function(){var items=[];this.forEach((function(value,name){items.push([name,value])}));return iteratorFor(items)};if(support.iterable){Headers.prototype[Symbol.iterator]=Headers.prototype.entries}function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError("Already read"))}body.bodyUsed=true}function fileReaderReady(reader){return new Promise((function(resolve,reject){reader.onload=function(){resolve(reader.result)};reader.onerror=function(){reject(reader.error)}}))}function readBlobAsArrayBuffer(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsArrayBuffer(blob);return promise}function readBlobAsText(blob){var reader=new FileReader;var promise=fileReaderReady(reader);reader.readAsText(blob);return promise}function readArrayBufferAsText(buf){var view=new Uint8Array(buf);var chars=new Array(view.length);for(var i=0;i<view.length;i++){chars[i]=String.fromCharCode(view[i])}return chars.join("")}function bufferClone(buf){if(buf.slice){return buf.slice(0)}else{var view=new Uint8Array(buf.byteLength);view.set(new Uint8Array(buf));return view.buffer}}function Body(){this.bodyUsed=false;this._initBody=function(body){this._bodyInit=body;if(!body){this._bodyText=""}else if(typeof body==="string"){this._bodyText=body}else if(support.blob&&Blob.prototype.isPrototypeOf(body)){this._bodyBlob=body}else if(support.formData&&FormData.prototype.isPrototypeOf(body)){this._bodyFormData=body}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this._bodyText=body.toString()}else if(support.arrayBuffer&&support.blob&&isDataView(body)){this._bodyArrayBuffer=bufferClone(body.buffer);this._bodyInit=new Blob([this._bodyArrayBuffer])}else if(support.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))){this._bodyArrayBuffer=bufferClone(body)}else{throw new Error("unsupported BodyInit type")}if(!this.headers.get("content-type")){if(typeof body==="string"){this.headers.set("content-type","text/plain;charset=UTF-8")}else if(this._bodyBlob&&this._bodyBlob.type){this.headers.set("content-type",this._bodyBlob.type)}else if(support.searchParams&&URLSearchParams.prototype.isPrototypeOf(body)){this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8")}}};if(support.blob){this.blob=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return Promise.resolve(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(new Blob([this._bodyArrayBuffer]))}else if(this._bodyFormData){throw new Error("could not read FormData body as blob")}else{return Promise.resolve(new Blob([this._bodyText]))}};this.arrayBuffer=function(){if(this._bodyArrayBuffer){return consumed(this)||Promise.resolve(this._bodyArrayBuffer)}else{return this.blob().then(readBlobAsArrayBuffer)}}}this.text=function(){var rejected=consumed(this);if(rejected){return rejected}if(this._bodyBlob){return readBlobAsText(this._bodyBlob)}else if(this._bodyArrayBuffer){return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))}else if(this._bodyFormData){throw new Error("could not read FormData body as text")}else{return Promise.resolve(this._bodyText)}};if(support.formData){this.formData=function(){return this.text().then(decode)}}this.json=function(){return this.text().then(JSON.parse)};return this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(input,options){options=options||{};var body=options.body;if(input instanceof Request){if(input.bodyUsed){throw new TypeError("Already read")}this.url=input.url;this.credentials=input.credentials;if(!options.headers){this.headers=new Headers(input.headers)}this.method=input.method;this.mode=input.mode;if(!body&&input._bodyInit!=null){body=input._bodyInit;input.bodyUsed=true}}else{this.url=String(input)}this.credentials=options.credentials||this.credentials||"omit";if(options.headers||!this.headers){this.headers=new Headers(options.headers)}this.method=normalizeMethod(options.method||this.method||"GET");this.mode=options.mode||this.mode||null;this.referrer=null;if((this.method==="GET"||this.method==="HEAD")&&body){throw new TypeError("Body not allowed for GET or HEAD requests")}this._initBody(body)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})};function decode(body){var form=new FormData;body.trim().split("&").forEach((function(bytes){if(bytes){var split=bytes.split("=");var name=split.shift().replace(/\+/g," ");var value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}}));return form}function parseHeaders(rawHeaders){var headers=new Headers;var preProcessedHeaders=rawHeaders.replace(/\r?\n[\t ]+/g," ");preProcessedHeaders.split(/\r?\n/).forEach((function(line){var parts=line.split(":");var key=parts.shift().trim();if(key){var value=parts.join(":").trim();headers.append(key,value)}}));return headers}Body.call(Request.prototype);function Response(bodyInit,options){if(!options){options={}}this.type="default";this.status=options.status===undefined?200:options.status;this.ok=this.status>=200&&this.status<300;this.statusText="statusText"in options?options.statusText:"OK";this.headers=new Headers(options.headers);this.url=options.url||"";this._initBody(bodyInit)}Body.call(Response.prototype);Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})};Response.error=function(){var response=new Response(null,{status:0,statusText:""});response.type="error";return response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(redirectStatuses.indexOf(status)===-1){throw new RangeError("Invalid status code")}return new Response(null,{status:status,headers:{location:url}})};self.Headers=Headers;self.Request=Request;self.Response=Response;self.fetch=function(input,init){return new Promise((function(resolve,reject){var request=new Request(input,init);var xhr=new XMLHttpRequest;xhr.onload=function(){var options={status:xhr.status,statusText:xhr.statusText,headers:parseHeaders(xhr.getAllResponseHeaders()||"")};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))};xhr.onerror=function(){reject(new TypeError("Network request failed"))};xhr.ontimeout=function(){reject(new TypeError("Network request failed"))};xhr.open(request.method,request.url,true);if(request.credentials==="include"){xhr.withCredentials=true}else if(request.credentials==="omit"){xhr.withCredentials=false}request.headers.forEach((function(value,name){xhr.setRequestHeader(name,value)}));xhr.send(typeof request._bodyInit==="undefined"?null:request._bodyInit)}))};self.fetch.polyfill=true})(window);var createDOMParser=function(){return new DOMParser};var globalContext=typeof global!=="undefined"?global:window;var createURLParser=function(){var anchorElement=null;var getAnchorElement=function(){anchorElement=anchorElement||globalContext.document.createElement("a");return anchorElement};var toAbsoluteURI=function(url){try{var element=getAnchorElement();element.href=url;return element.href}catch(err){return""}};return{toAbsoluteURI:toAbsoluteURI}};
/*! *****************************************************************************
  Copyright (c) Microsoft Corporation. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var extendStatics=function(d,b){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return extendStatics(d,b)};function __extends(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}function __awaiter(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))}function __generator(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}var nativeIsFiniteNumber=Number.isFinite;var isFile=function(testValue){return Object.prototype.toString.call(testValue)==="[object File]"||testValue instanceof File};var isFormData=function(testValue){return Object.prototype.toString.call(testValue)==="[object FormData]"||testValue instanceof FormData};var isHTMLDocument=function(testValue){return Object.prototype.toString.call(testValue)==="[object HTMLDocument]"};var isFiniteNumber=function(testValue){return nativeIsFiniteNumber(testValue)};var isFunction=function(testValue){return typeof testValue==="function"};var isNegativeZero=function(testValue){return testValue===0&&1/testValue===-Infinity};var hasValue=function(target,propertyName){var descriptor=Object.getOwnPropertyDescriptor(target,propertyName);return descriptor?{}.hasOwnProperty.call(descriptor,"value"):false};var nativeToString=function toString(){return"function toString() {\n    [native code]\n}"};var createNativeToString=function(methodName){if(methodName==="toString"){return nativeToString}function toString(){return"function "+methodName+"() {\n    [native code]\n}"}toString.toString=nativeToString;return toString};var exposeConstant=function(target,constantName,constantValue){Object.defineProperty(target,constantName,{configurable:false,enumerable:true,value:constantValue,writable:false})};var makeMembersEnumerable=function(target){Object.getOwnPropertyNames(target).forEach((function(propertyName){Object.defineProperty(target,propertyName,{enumerable:true})}))};var makeMembersReadonly=function(target,members){members.forEach((function(member){Object.defineProperty(target,member,{configurable:false,writable:false})}))};var sealObject=function(target){Object.seal(target)};var applyNativeToString=function(target){Object.keys(target).filter((function(propertyName){return hasValue(target,propertyName)})).filter((function(propertyName){return isFunction(target[propertyName])})).forEach((function(methodName){target[methodName].toString=createNativeToString(methodName)}))};var testDOMException=function(){try{new DOMException("Test");return true}catch(err){return false}};var canCreateDOMException=testDOMException();var createDOMException=function(message){return canCreateDOMException?new DOMException(message):new Error(message)};var createPlainError=function(message){return new Error(message)};var createPlainTypeError=function(message){return new TypeError(message)};var createErrorFactory=function(componentName){return function(message){return createPlainError("["+componentName+"] "+message)}};var isNativeAvailable=typeof Symbol==="function";var createSymbol=function(description){return isNativeAvailable?Symbol(description):"Symbol("+description+")"};var createEventTargetInternals=function(){return{listenerRegistry:new Map}};var _a;var INTERNALS_KEY=createSymbol("[[EventTargetInternals]]");var getListenerRegistry=function(instance){return instance[INTERNALS_KEY].listenerRegistry};var EventTarget=function(){function EventTarget(){this[_a]=createEventTargetInternals()}EventTarget.prototype.addEventListener=function(eventType,callback){var listenerRegistry=getListenerRegistry(this);var listeners=listenerRegistry.get(eventType)||[];if(!listenerRegistry.has(eventType)){listenerRegistry.set(eventType,listeners)}listeners.push(callback)};EventTarget.prototype.dispatchEvent=function(event){var _this=this;var listenerRegistry=getListenerRegistry(this);var listeners=listenerRegistry.get(event.type);if(!listeners){return true}var listenersCopy=listeners.slice();listenersCopy.forEach((function(listener){listener.call(_this,event)}));return!event.defaultPrevented};EventTarget.prototype.removeEventListener=function(eventType,eventListener){var listenerRegistry=getListenerRegistry(this);var listeners=listenerRegistry.get(eventType);if(!listeners){return}listeners.forEach((function(currentListener,index){if(currentListener===eventListener){listeners.splice(index,1);return}}))};return EventTarget}();_a=INTERNALS_KEY;var EventTargetPrototype=EventTarget.prototype;makeMembersEnumerable(EventTargetPrototype);makeMembersReadonly(EventTargetPrototype,["addEventListener","dispatchEvent","removeEventListener"]);sealObject(EventTargetPrototype);applyNativeToString(EventTargetPrototype);var createXMLHttpRequestEventTargetInternals=function(){return{onabortValue:null,onerrorValue:null,onloadValue:null,onloadendValue:null,onloadstartValue:null,onprogressValue:null,ontimeoutValue:null}};var _a$1;var INTERNALS_KEY$1=createSymbol("[[XMLHttpRequestEventTargetInternals]]");var getInternals=function(instance){return instance[INTERNALS_KEY$1]};var normalizeListener=function(listener){return isFunction(listener)?listener:null};var XMLHttpRequestEventTarget=function(_super){__extends(XMLHttpRequestEventTarget,_super);function XMLHttpRequestEventTarget(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this[_a$1]=createXMLHttpRequestEventTargetInternals();return _this}Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onabort",{get:function(){return getInternals(this).onabortValue},set:function(listener){getInternals(this).onabortValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onerror",{get:function(){return getInternals(this).onerrorValue},set:function(listener){getInternals(this).onerrorValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onload",{get:function(){return getInternals(this).onloadValue},set:function(listener){getInternals(this).onloadValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onloadend",{get:function(){return getInternals(this).onloadendValue},set:function(listener){getInternals(this).onloadendValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onloadstart",{get:function(){return getInternals(this).onloadstartValue},set:function(listener){getInternals(this).onloadstartValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"onprogress",{get:function(){return getInternals(this).onprogressValue},set:function(listener){getInternals(this).onprogressValue=normalizeListener(listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestEventTarget.prototype,"ontimeout",{get:function(){return getInternals(this).ontimeoutValue},set:function(listener){getInternals(this).ontimeoutValue=normalizeListener(listener)},enumerable:true,configurable:true});return XMLHttpRequestEventTarget}(EventTarget);_a$1=INTERNALS_KEY$1;makeMembersEnumerable(XMLHttpRequestEventTarget.prototype);sealObject(XMLHttpRequestEventTarget.prototype);applyNativeToString(XMLHttpRequestEventTarget.prototype);var DEFAULT_MIME_TYPE_TEXT_HTML="text/html;charset=UTF-8";var DEFAULT_MIME_TYPE_TEXT_PLAIN="text/plain;charset=UTF-8";var DEFAULT_PLUGIN_TIMEOUT=864e5;var INTERNALS_KEY$2=createSymbol("[[XMLHttpRequestInternals]]");var FORBIDDEN_HTTP_METHODS=["connect","trace","track"];var FORBIDDEN_REQUEST_HEADERS=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","date","dnt","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","via"];var FORBIDDEN_REQUEST_HEADERS_RE=[/^proxy-/,/^sec-/];var HEADER_CONTENT_TYPE="Content-Type";var HTTP_METHOD_RE=/^[\w+-~!#]+$/;var STANDARD_HTTP_METHODS=["connect","delete","get","head","options","patch","post","put","trace","track"];var SUPPORTED_RESPONSE_TYPE=["","arraybuffer","blob","document","json","text"];var SUPPORTED_RESPONSE_TYPE_DOCUMENT_MIME_TYPE=["text/html","text/xml","application/xml","application/xhtml+xml","image/svg+xml"];var READY_STATE_DONE="DONE";var READY_STATE_HEADERS_RECEIVED="HEADERS_RECEIVED";var READY_STATE_LOADING="LOADING";var READY_STATE_OPENED="OPENED";var READY_STATE_UNSENT="UNSENT";var StatusText;(function(StatusText){StatusText["Accepted"]="Accepted";StatusText["AlreadyReported"]="Already Reported";StatusText["BadGateway"]="Bad Gateway";StatusText["BadRequest"]="Bad Request";StatusText["Conflict"]="Conflict";StatusText["Created"]="Created";StatusText["ExpectationFailed"]="Expectation Failed";StatusText["FailedDependency"]="Failed Dependency";StatusText["Forbidden"]="Forbidden";StatusText["GatewayTimeout"]="Gateway Timeout";StatusText["Gone"]="Gone";StatusText["HTTPVersionNotSupported"]="HTTP Version Not Supported";StatusText["IMUsed"]="IM Used";StatusText["InsufficientStorage"]="Insufficient Storage";StatusText["InternalServerError"]="Internal Server Error";StatusText["LengthRequired"]="Length Required";StatusText["Locked"]="Locked";StatusText["LoopDetected"]="Loop Detected";StatusText["MethodNotAllowed"]="Method Not Allowed";StatusText["MisdirectedRequest"]="Misdirected Request";StatusText["MultiStatus"]="Multi-Status";StatusText["NetworkAuthenticationRequired"]="Network Authentication Required";StatusText["NoContent"]="No Content";StatusText["NonAuthoritativeInformation"]="Non-Authoritative Information";StatusText["NotAcceptable"]="Not Acceptable";StatusText["NotExtended"]="Not Extended";StatusText["NotFound"]="Not Found";StatusText["NotImplemented"]="Not Implemented";StatusText["OK"]="OK";StatusText["PartialContent"]="Partial Content";StatusText["PayloadTooLarge"]="Payload Too Large";StatusText["PaymentRequired"]="Payment Required";StatusText["PreconditionFailed"]="Precondition Failed";StatusText["PreconditionRequired"]="Precondition Required";StatusText["RangeNotSatisfiable"]="Range Not Satisfiable";StatusText["RequestHeaderFieldsTooLarge"]="Request Header Fields Too Large";StatusText["RequestTimeout"]="Request Timeout";StatusText["ResetContent"]="Reset Content";StatusText["ServiceUnavailable"]="Service Unavailable";StatusText["TooManyRequests"]="Too Many Requests";StatusText["Unauthorized"]="Unauthorized";StatusText["UnavailableForLegalReasons"]="Unavailable For Legal Reasons";StatusText["UnprocessableEntity"]="Unprocessable Entity";StatusText["UnsupportedMediaType"]="Unsupported Media Type";StatusText["UpgradeRequired"]="Upgrade Required";StatusText["URITooLong"]="URI Too Long";StatusText["VariantAlsoNegotiates"]="Variant Also Negotiates";StatusText["Unknown"]="Unknown"})(StatusText||(StatusText={}));var requestConfigToJSONString=function(requestConfig){return JSON.stringify(requestConfig)};var BBXHRPluginName="BBXHR";var BBXHRPluginRequestErrorName;(function(BBXHRPluginRequestErrorName){BBXHRPluginRequestErrorName["NetworkFailed"]="ERR_NETWORK_FAILED";BBXHRPluginRequestErrorName["RequestAborted"]="ERR_REQUEST_ABORTED";BBXHRPluginRequestErrorName["RequestTimeout"]="ERR_REQUEST_TIMEOUT";BBXHRPluginRequestErrorName["TooManyRedirects"]="ERR_TOO_MANY_REDIRECTS";BBXHRPluginRequestErrorName["Unexpected"]="ERR_UNEXPECTED"})(BBXHRPluginRequestErrorName||(BBXHRPluginRequestErrorName={}));var BBXHRPluginReadyState;(function(BBXHRPluginReadyState){BBXHRPluginReadyState["Pending"]="PENDING";BBXHRPluginReadyState["Initiated"]="INITIATED";BBXHRPluginReadyState["Uploading"]="UPLOADING";BBXHRPluginReadyState["HeadersReceived"]="HEADERS_RECEIVED";BBXHRPluginReadyState["Loading"]="LOADING";BBXHRPluginReadyState["Complete"]="COMPLETE"})(BBXHRPluginReadyState||(BBXHRPluginReadyState={}));var arraySlice=Array.prototype.slice;var byteArrayToArray=function(byteArray){return arraySlice.call(byteArray)};var find=function(arr,fn){for(var index=0;index<arr.length;index++){var item=arr[index];if(fn(item,index)){return arr[index]}}};var includes=function(arr,item){return arr.indexOf(item)!==-1};var CustomTextEncoder=function(){function CustomTextEncoder(){}CustomTextEncoder.prototype.encode=function(text){var textSize=text.length;var resultPosition=-1;var result=new Uint8Array(textSize*3);for(var point=0,nextCode=0,charIndex=0;charIndex!==textSize;){point=text.charCodeAt(charIndex);charIndex++;if(point>=55296&&point<=56319){if(charIndex===textSize){result[resultPosition+=1]=239;result[resultPosition+=1]=191;result[resultPosition+=1]=189;break}nextCode=text.charCodeAt(charIndex);if(nextCode>=56320&&nextCode<=57343){point=(point-55296)*1024+nextCode-56320+65536;charIndex++;if(point>65535){result[resultPosition+=1]=30<<3|point>>>18;result[resultPosition+=1]=2<<6|point>>>12&63;result[resultPosition+=1]=2<<6|point>>>6&63;result[resultPosition+=1]=2<<6|point&63;continue}}else{result[resultPosition+=1]=239;result[resultPosition+=1]=191;result[resultPosition+=1]=189;continue}}if(point<=127){result[resultPosition+=1]=0<<7|point}else if(point<=2047){result[resultPosition+=1]=6<<5|point>>>6;result[resultPosition+=1]=2<<6|point&63}else{result[resultPosition+=1]=14<<4|point>>>12;result[resultPosition+=1]=2<<6|point>>>6&63;result[resultPosition+=1]=2<<6|point&63}}return result.subarray(0,resultPosition+1)};return CustomTextEncoder}();var createTextEncoder=function(){var EncoderClass=typeof TextEncoder!=="undefined"?TextEncoder:CustomTextEncoder;return new EncoderClass};var encoder=createTextEncoder();var bytesToHexString=function(bytes){return byteArrayToArray(bytes).map((function(byte){var byteString=byte.toString(16);return byteString.length===1?"0"+byteString:byteString})).join("")};var stringToBytes=function(string){return encoder.encode(string)};var createEvent=function(eventType){return new Event(eventType,{bubbles:false,cancelable:false})};var createProgressEvent=function(eventType){return new ProgressEvent(eventType,{bubbles:false,cancelable:false})};var createEventDispatcher=function(){var dispatchErrorEvent=function(instance){var event=createProgressEvent("error");instance.dispatchEvent(event);if(instance.onerror){instance.onerror(event)}};var dispatchLoadEvent=function(instance){var event=createProgressEvent("load");instance.dispatchEvent(event);if(instance.onload){instance.onload(event)}};var dispatchReadyStateChangeEvent=function(instance){var event=createEvent("readystatechange");instance.dispatchEvent(event);if(instance.onreadystatechange){instance.onreadystatechange(event)}};var dispatchTimeoutEvent=function(instance){var event=createProgressEvent("timeout");instance.dispatchEvent(event);if(instance.ontimeout){instance.ontimeout(event)}};return{dispatchErrorEvent:dispatchErrorEvent,dispatchLoadEvent:dispatchLoadEvent,dispatchReadyStateChangeEvent:dispatchReadyStateChangeEvent,dispatchTimeoutEvent:dispatchTimeoutEvent}};var decodeBase64=function(base64Text){return globalContext.atob(base64Text)};var StatusCodeToTextMap={200:StatusText.OK,201:StatusText.Created,202:StatusText.Accepted,203:StatusText.NonAuthoritativeInformation,204:StatusText.NoContent,205:StatusText.ResetContent,206:StatusText.PartialContent,207:StatusText.MultiStatus,208:StatusText.AlreadyReported,226:StatusText.IMUsed,400:StatusText.BadRequest,401:StatusText.Unauthorized,402:StatusText.PaymentRequired,403:StatusText.Forbidden,404:StatusText.NotFound,405:StatusText.MethodNotAllowed,406:StatusText.NotAcceptable,408:StatusText.RequestTimeout,409:StatusText.Conflict,410:StatusText.Gone,411:StatusText.LengthRequired,412:StatusText.PreconditionFailed,413:StatusText.PayloadTooLarge,414:StatusText.URITooLong,415:StatusText.UnsupportedMediaType,416:StatusText.RangeNotSatisfiable,417:StatusText.ExpectationFailed,421:StatusText.MisdirectedRequest,422:StatusText.UnprocessableEntity,423:StatusText.Locked,424:StatusText.FailedDependency,426:StatusText.UpgradeRequired,428:StatusText.PreconditionRequired,429:StatusText.TooManyRequests,431:StatusText.RequestHeaderFieldsTooLarge,451:StatusText.UnavailableForLegalReasons,500:StatusText.InternalServerError,501:StatusText.NotImplemented,502:StatusText.BadGateway,503:StatusText.ServiceUnavailable,504:StatusText.GatewayTimeout,505:StatusText.HTTPVersionNotSupported,506:StatusText.VariantAlsoNegotiates,507:StatusText.InsufficientStorage,508:StatusText.LoopDetected,510:StatusText.NotExtended,511:StatusText.NetworkAuthenticationRequired};var decodeResponseBody=function(responseBodyAsBase64){if(responseBodyAsBase64===null||responseBodyAsBase64===undefined){return null}try{return decodeURIComponent(decodeBase64(responseBodyAsBase64))}catch(err){console.error(err);return""}};var getStatusTextForCode=function(statusCode){return StatusCodeToTextMap[statusCode]||StatusText.Unknown};var isFileRequest=function(requestUrl){return requestUrl.indexOf("file://")===0};var isForbiddenHttpMethod=function(httpMethod){return includes(FORBIDDEN_HTTP_METHODS,httpMethod.toLowerCase())};var isForbiddenRequestHeader=function(header){header=header.toLowerCase();return includes(FORBIDDEN_REQUEST_HEADERS,header)||FORBIDDEN_REQUEST_HEADERS_RE.some((function(headerRe){return headerRe.test(header)}))};var isHttpMethodValid=function(httpMethod){return HTTP_METHOD_RE.test(httpMethod)};var isHttpStatusOK=function(statusCode){return statusCode>=200&&statusCode<300};var isStandardHttpMethod=function(method){return includes(STANDARD_HTTP_METHODS,method.toLowerCase())};var normalizeHttpMethod=function(httpMethod){httpMethod=String(httpMethod);if(isStandardHttpMethod(httpMethod)){return httpMethod.toUpperCase()}return httpMethod};var NativeXMLHttpRequest=globalContext.XMLHttpRequest;var parseHeaders=function(headersAsText){return headersAsText.split("\n").reduce((function(headers,headerAsText){var parts=headerAsText.split(":");var name=(parts[0]||"").trim();headers[name]=(parts[1]||"").trim();return headers}),{})};var loadFile=function(fileUrl,onLoad,onError){var xhr=new NativeXMLHttpRequest;xhr.onload=function(){onLoad(xhr.response,parseHeaders(xhr.getAllResponseHeaders()))};xhr.onerror=onError;xhr.open("GET",fileUrl);xhr.send()};var readFileAsArrayBuffer=function(file){return new Promise((function(resolve,reject){var reader=new FileReader;reader.onloadend=function(){if(reader.error){reject(reader.error)}else{var result=reader.result;if(result instanceof ArrayBuffer){resolve(result)}else{reject("Could not read the file content as ArrayBuffer")}}};reader.readAsArrayBuffer(file)}))};var mergeUint8Arrays=function(){var arrays=[];for(var _i=0;_i<arguments.length;_i++){arrays[_i]=arguments[_i]}var totalLength=0;for(var _a=0,arrays_1=arrays;_a<arrays_1.length;_a++){var arr=arrays_1[_a];totalLength+=arr.length}var result=new Uint8Array(totalLength);var offset=0;for(var _b=0,arrays_2=arrays;_b<arrays_2.length;_b++){var arr=arrays_2[_b];result.set(arr,offset);offset+=arr.length}return result};var contentDispositionBytes=stringToBytes("Content-Disposition: form-data; ");var contentTypeBytes=stringToBytes("Content-Type: ");var defaultContentTypeBytes=stringToBytes("application/octet-stream");var doubleDashBytes=stringToBytes("--");var doubleQuoteBytes=stringToBytes('"');var nameBytes=stringToBytes("name=");var fileNameBytes=stringToBytes(" filename=");var semicolonBytes=stringToBytes(";");var lineBreakBytes=new Uint8Array([13,10]);var generateBoundary=function(){var id="xxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(c){var r=Math.random()*16|0;var v=c==="x"?r:r&3|8;return v.toString(16)}));return"----WebKitFormBoundary"+id};var escapeForbiddenChars=function(key){return key.replace(/"/g,"%22").replace(/\r/g,"%0D").replace(/\n/g,"%0A")};var formDataEntries=function(formData){if(!formData.entries){throw createDOMException("Failed to send FormData: FormData#entries() is not supported.")}return Array.from(formData.entries())};var formEntryData=function(name,value){return __awaiter(void 0,void 0,void 0,(function(){var result,file,valueAsArrayBuffer,valueAsByteArray;return __generator(this,(function(_a){switch(_a.label){case 0:result=[];name=escapeForbiddenChars(name);result.push(contentDispositionBytes,nameBytes,doubleQuoteBytes,stringToBytes(name),doubleQuoteBytes);if(!isFile(value))return[3,2];file=value;result.push(semicolonBytes,fileNameBytes,doubleQuoteBytes,stringToBytes(escapeForbiddenChars(file.name)),doubleQuoteBytes,lineBreakBytes);result.push(contentTypeBytes,file.type?stringToBytes(file.type):defaultContentTypeBytes,lineBreakBytes);return[4,readFileAsArrayBuffer(file)];case 1:valueAsArrayBuffer=_a.sent();valueAsByteArray=new Uint8Array(valueAsArrayBuffer);result.push(lineBreakBytes,valueAsByteArray);return[3,3];case 2:result.push(lineBreakBytes,lineBreakBytes,stringToBytes(value));_a.label=3;case 3:return[2,result]}}))}))};var formDataAsByteArray=function(formData,boundaryBytes){return __awaiter(void 0,void 0,void 0,(function(){var entryList,entryPromiseList,result,_i,entryPromiseList_1,entryPromise,entry;return __generator(this,(function(_a){switch(_a.label){case 0:entryList=formDataEntries(formData);entryPromiseList=entryList.map((function(entry){return formEntryData(entry[0],entry[1])}));result=[];_i=0,entryPromiseList_1=entryPromiseList;_a.label=1;case 1:if(!(_i<entryPromiseList_1.length))return[3,4];entryPromise=entryPromiseList_1[_i];return[4,entryPromise];case 2:entry=_a.sent();result.push(doubleDashBytes,boundaryBytes);result.push(lineBreakBytes);result.push.apply(result,entry);result.push(lineBreakBytes);_a.label=3;case 3:_i++;return[3,1];case 4:if(entryList.length>0){result.push(doubleDashBytes,boundaryBytes,doubleDashBytes);result.push(lineBreakBytes)}return[2,mergeUint8Arrays.apply(void 0,result)]}}))}))};var fromFormData=function(formData){return __awaiter(void 0,void 0,void 0,(function(){var boundary,boundaryBytes,body,contentLength,contentType;return __generator(this,(function(_a){switch(_a.label){case 0:boundary=generateBoundary();boundaryBytes=stringToBytes(boundary);return[4,formDataAsByteArray(formData,boundaryBytes)];case 1:body=_a.sent();contentLength=body.byteLength;contentType="multipart/form-data; boundary="+boundary;return[2,{body:body,contentLength:contentLength,contentType:contentType}]}}))}))};var fromHTMLDocument=function(htmlDocument){var html=htmlDocument.documentElement.outerHTML;var body=stringToBytes(html);var contentLength=body.length;var contentType=DEFAULT_MIME_TYPE_TEXT_HTML;return Promise.resolve({body:body,contentLength:contentLength,contentType:contentType})};var fromPlainText=function(text){var body=stringToBytes(text);var contentLength=body.length;var contentType=DEFAULT_MIME_TYPE_TEXT_PLAIN;return Promise.resolve({body:body,contentLength:contentLength,contentType:contentType})};var extractBody=function(body){if(isHTMLDocument(body)){return fromHTMLDocument(body)}if(isFormData(body)){return fromFormData(body)}return fromPlainText(body)};var ReadyState;(function(ReadyState){ReadyState[ReadyState["Unsent"]=0]="Unsent";ReadyState[ReadyState["Opened"]=1]="Opened";ReadyState[ReadyState["HeadersReceived"]=2]="HeadersReceived";ReadyState[ReadyState["Loading"]=3]="Loading";ReadyState[ReadyState["Done"]=4]="Done"})(ReadyState||(ReadyState={}));var XMLHttpRequestUpload=function(_super){__extends(XMLHttpRequestUpload,_super);function XMLHttpRequestUpload(){return _super!==null&&_super.apply(this,arguments)||this}return XMLHttpRequestUpload}(XMLHttpRequestEventTarget);makeMembersEnumerable(XMLHttpRequestUpload.prototype);applyNativeToString(XMLHttpRequestUpload.prototype);var XMLHttpRequestInternals=function(){function XMLHttpRequestInternals(){this.onreadystatechangeValue=null;this.uploadValue=new XMLHttpRequestUpload;this.reset()}Object.defineProperty(XMLHttpRequestInternals.prototype,"onreadystatechange",{get:function(){return this.onreadystatechangeValue},set:function(handler){if(isFunction(handler)){this.onreadystatechangeValue=handler}},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"parsedResponseBody",{get:function(){return this.parsedResponseBodyValue},set:function(parsedResponseBody){this.parsedResponseBodyValue=parsedResponseBody},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"readyState",{get:function(){return this.readyStateValue},set:function(readyState){this.readyStateValue=readyState},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"requestBody",{get:function(){return this.requestBodyValue},set:function(requestBody){this.requestBodyValue=requestBody},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"requestHeaders",{get:function(){return this.requestHeadersValue},set:function(requestHeaders){this.requestHeadersValue=requestHeaders},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"requestMethod",{get:function(){return this.requestMethodValue},set:function(requestMethod){this.requestMethodValue=requestMethod},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"requestSent",{get:function(){return this.requestSentValue},set:function(requestSent){this.requestSentValue=requestSent},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"requestUrl",{get:function(){return this.requestUrlValue},set:function(requestUrl){this.requestUrlValue=requestUrl},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"responseBody",{get:function(){return this.responseBodyValue},set:function(responseBody){if(responseBody!==null){this.responseBodyValue=this.responseBodyValue+responseBody}},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"responseBodyConsumed",{get:function(){return this.responseBodyConsumedValue},set:function(responseBodyConsumed){this.responseBodyConsumedValue=responseBodyConsumed},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"responseHeaders",{get:function(){return this.responseHeadersValue},set:function(responseHeaders){this.responseHeadersValue=responseHeaders},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"responseType",{get:function(){return this.responseTypeValue},set:function(responseType){if(includes(SUPPORTED_RESPONSE_TYPE,responseType)){var canUpdate=this.readyState<ReadyState.Loading;if(!canUpdate){throw createDOMException("InvalidStateError: Failed to set the 'responseType' property on 'XMLHttpRequest': "+"The response type cannot be set if the object's state is LOADING or DONE.")}this.responseTypeValue=responseType}else{console.warn("The provided value '"+responseType+"' is not a valid enum value "+"of type XMLHttpRequestResponseType")}},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"responseURL",{get:function(){return this.responseURLValue},set:function(responseURL){this.responseURLValue=responseURL},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"status",{get:function(){return this.statusValue},set:function(status){this.statusValue=status},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"statusText",{get:function(){return this.statusTextValue},set:function(statusText){this.statusTextValue=statusText},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"timeout",{get:function(){return this.timeoutValue},set:function(timeout){this.timeoutValue=timeout},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequestInternals.prototype,"upload",{get:function(){return this.uploadValue},set:function(upload){this.uploadValue=upload},enumerable:true,configurable:true});XMLHttpRequestInternals.prototype.addRequestHeader=function(header,value){var existingHeader=this.getCaseInsensitiveRequestHeader(header);var normalizedValue=value.trim();if(existingHeader){var previousValue=this.requestHeaders[existingHeader];this.requestHeaders[existingHeader]=previousValue+", "+normalizedValue}else{this.requestHeaders[header]=normalizedValue}};XMLHttpRequestInternals.prototype.getCaseInsensitiveRequestHeader=function(header){var headerToSearch=header.toLowerCase();var existingHeaders=Object.keys(this.requestHeaders);return find(existingHeaders,(function(headerToCheck){return headerToCheck.toLowerCase()===headerToSearch}))};XMLHttpRequestInternals.prototype.getProcessedResponseHeaders=function(){var headers=this.responseHeaders;return Object.keys(headers).map((function(header){return[header.toLowerCase(),headers[header]]})).sort((function(_a,_b){var headerA=_a[0];var headerB=_b[0];return headerA.localeCompare(headerB)}))};XMLHttpRequestInternals.prototype.hasCaseInsensitiveRequestHeader=function(header){return this.getCaseInsensitiveRequestHeader(header)!==void 0};XMLHttpRequestInternals.prototype.reset=function(initialValues){this.parsedResponseBodyValue=null;this.readyStateValue=ReadyState.Unsent;this.requestBodyValue=null;this.requestHeadersValue={};this.requestMethodValue="";this.requestSentValue=false;this.requestUrlValue="";this.responseBodyValue="";this.responseBodyConsumedValue=false;this.responseHeadersValue={};this.responseTypeValue="";this.responseURLValue="";this.status=0;this.statusText="";this.timeout=0;this.uploadValue=new XMLHttpRequestUpload;if(initialValues){Object.assign(this,initialValues)}};return XMLHttpRequestInternals}();var createCustomXHRImplementation=function(bbxhrPlugin,domParser,urlParser,language){var createError=createErrorFactory("hsdk-core");var eventDispatcher=createEventDispatcher();var setRequestBodyAndContentType=function(instance,body){return __awaiter(void 0,void 0,void 0,(function(){var requestBody,internalState,extractedBody,contentLength,originalAuthorContentType,extractedContentType;return __generator(this,(function(_a){switch(_a.label){case 0:requestBody=null;internalState=getInternals(instance);if(internalState.requestMethod==="GET"||internalState.requestMethod==="HEAD"){body=null}if(!(body!==null&&body!==undefined))return[3,2];return[4,extractBody(body)];case 1:extractedBody=_a.sent();contentLength=extractedBody.contentLength;setRequestHeader(instance,"Content-Length",String(contentLength),true);originalAuthorContentType=getRequestHeader(instance,"Content-Type");requestBody=extractedBody.body;if(!originalAuthorContentType){extractedContentType=extractedBody.contentType;if(extractedContentType){setRequestHeader(instance,"Content-Type",extractedContentType,true)}}_a.label=2;case 2:internalState.requestBody=requestBody;return[2]}}))}))};var getInternals=function(instance){return instance[INTERNALS_KEY$2]};var getRequestHeader=function(instance,header){var value=getInternals(instance).getCaseInsensitiveRequestHeader(header);return value!==void 0?value:null};var getAllRequestHeaders=function(instance){var internalState=getInternals(instance);var authorRequestHeaders=internalState.requestHeaders;var defaultRequestHeaders={};var systemRequestHeaders={"bb.nsurlrequest.webview":"true"};if(!internalState.hasCaseInsensitiveRequestHeader("Accept")){defaultRequestHeaders["Accept"]="*/*"}if(!internalState.hasCaseInsensitiveRequestHeader("Accept-Language")){defaultRequestHeaders["Accept-Language"]=language}return Object.assign(defaultRequestHeaders,authorRequestHeaders,systemRequestHeaders)};var handlePluginError=function(instance,pluginError){var internalState=getInternals(instance);if(!internalState.requestSent){return}console.debug("[bbxhr] Request failed:",pluginError);printRequestError(instance,pluginError);if(pluginError.name===BBXHRPluginRequestErrorName.RequestTimeout){handleTimeout(instance);return}handleNetworkError(instance)};var handlePluginResponse=function(instance,pluginResponse){var internalState=getInternals(instance);var canReadHeaders=pluginResponse.readyState===BBXHRPluginReadyState.HeadersReceived;var canReadBody=pluginResponse.readyState===BBXHRPluginReadyState.Loading||pluginResponse.readyState===BBXHRPluginReadyState.Complete;var readyState=pluginResponseToReadyState(pluginResponse);var readyStateChanged=readyState!==internalState.readyState;if(canReadHeaders){internalState.responseHeaders=pluginResponse.headers;internalState.status=pluginResponse.status;internalState.statusText=getStatusTextForCode(pluginResponse.status);internalState.responseURL=pluginResponse.responseURL}if(canReadBody){internalState.responseBody=decodeResponseBody(pluginResponse.body)}if(readyStateChanged){internalState.readyState=readyState;eventDispatcher.dispatchReadyStateChangeEvent(instance);if(internalState.readyState===ReadyState.Done){internalState.requestSent=false;eventDispatcher.dispatchLoadEvent(instance);console.debug("[bbxhr] Request complete:",{body:internalState.responseBody,headers:internalState.responseHeaders,responseURL:internalState.responseURL,status:internalState.status,statusText:internalState.statusText});if(!isHttpStatusOK(internalState.status)){printRequestError(instance)}}}};var handleNetworkError=function(instance){var internalState=getInternals(instance);internalState.status=0;internalState.statusText="";internalState.readyState=ReadyState.Done;eventDispatcher.dispatchReadyStateChangeEvent(instance);eventDispatcher.dispatchErrorEvent(instance)};var handleTimeout=function(instance){var internalState=getInternals(instance);internalState.status=0;internalState.statusText="";internalState.readyState=ReadyState.Done;eventDispatcher.dispatchReadyStateChangeEvent(instance);eventDispatcher.dispatchTimeoutEvent(instance)};var isFileSchemeSupportedByPlugin=null;var shouldUsePlugin=function(requestUrl,callback){if(!isFileRequest(requestUrl)){callback(true);return}if(isFileSchemeSupportedByPlugin!==null){callback(isFileSchemeSupportedByPlugin);return}bbxhrPlugin.isFileSchemeSupported((function(response){isFileSchemeSupportedByPlugin=response==="true"||response===true;callback(isFileSchemeSupportedByPlugin)}),(function(){isFileSchemeSupportedByPlugin=false;callback(isFileSchemeSupportedByPlugin)}))};var isResponseAvailable=function(responseType,readyState){if(isTextResponse(responseType)){return readyState===ReadyState.HeadersReceived||readyState===ReadyState.Loading||readyState===ReadyState.Done}return readyState===ReadyState.Done};var getEmptyResponse=function(responseType){return isTextResponse(responseType)?"":null};var isTextResponse=function(responseType){return responseType===""||responseType==="text"};var printRequestError=function(instance,pluginError){var internalState=getInternals(instance);var requestMethod=internalState.requestMethod;var requestUrl=internalState.requestUrl;var errorText=pluginError?pluginError.name:internalState.status+" "+internalState.statusText;console.error(requestMethod+" "+requestUrl+" "+errorText)};var normalizeTimeout=function(timeout){timeout=Number(timeout);return isFiniteNumber(timeout)&&!isNegativeZero(timeout)?timeout:0};var parseResponseBody=function(responseBody,responseType,responseMimeType){if(responseType==="json"){return parseResponseBodyAsJSON(responseBody)}if(responseType==="document"){return parseResponseBodyAsDocument(responseBody,responseMimeType)}return null};var parseResponseBodyAsJSON=function(responseBody){try{return JSON.parse(responseBody)}catch(err){return null}};var parseResponseBodyAsDocument=function(responseBody,responseMimeType){var isSupportedMimeType=responseMimeType&&SUPPORTED_RESPONSE_TYPE_DOCUMENT_MIME_TYPE.indexOf(responseMimeType)!==-1;var mimeType=isSupportedMimeType?responseMimeType:"text/html";return domParser.parseFromString(responseBody,mimeType)};var pluginResponseToReadyState=function(pluginResponse){var pluginReadyState=pluginResponse.readyState;if(pluginReadyState===BBXHRPluginReadyState.HeadersReceived){return ReadyState.HeadersReceived}if(pluginReadyState===BBXHRPluginReadyState.Loading){return ReadyState.Loading}if(pluginReadyState===BBXHRPluginReadyState.Complete){return ReadyState.Done}return ReadyState.Opened};var abort=function(instance){};var onreadystatechangeGetter=function(instance){return getInternals(instance).onreadystatechange};var onreadystatechangeSetter=function(instance,listener){getInternals(instance).onreadystatechange=listener};var getResponseHeader=function(instance,header){var responseHeaders=getInternals(instance).responseHeaders;header=header.toLowerCase();for(var responseHeader in responseHeaders){if({}.hasOwnProperty.call(responseHeaders,responseHeader)&&responseHeader.toLowerCase()===header){return responseHeaders[responseHeader]}}return null};var getAllResponseHeaders=function(instance){return getInternals(instance).getProcessedResponseHeaders().map((function(_a){var header=_a[0],value=_a[1];return header+": "+value})).join("\n")};var open=function(instance,requestMethod,requestUrl){var internalState=getInternals(instance);var readyState=ReadyState.Opened;var timeout=internalState.timeout;requestMethod=normalizeHttpMethod(requestMethod);if(!isHttpMethodValid(requestMethod)){throw createDOMException("Failed to execute 'open' on 'XMLHttpRequest': '"+requestMethod+"' is not a valid HTTP method.")}if(isForbiddenHttpMethod(requestMethod)){throw createDOMException("Failed to execute 'open' on 'XMLHttpRequest': '"+requestMethod+"' HTTP method is unsupported")}requestUrl=urlParser.toAbsoluteURI(requestUrl);if(!requestUrl){throw createDOMException("Failed to execute 'open' on 'XMLHttpRequest': Invalid URL")}internalState.reset({readyState:readyState,requestMethod:requestMethod,requestUrl:requestUrl,timeout:timeout});eventDispatcher.dispatchReadyStateChangeEvent(instance)};var overrideMimeType=function(instance,mime){};var readyStateGetter=function(instance){return getInternals(instance).readyState};var responseGetter=function(instance){var internalState=getInternals(instance);var readyState=internalState.readyState,responseBody=internalState.responseBody,responseBodyConsumed=internalState.responseBodyConsumed,responseType=internalState.responseType;if(!isResponseAvailable(responseType,readyState)){return getEmptyResponse(responseType)}if(isTextResponse(responseType)){return responseBody}if(!responseBodyConsumed){var responseMimeType=getResponseHeader(instance,HEADER_CONTENT_TYPE);internalState.parsedResponseBody=parseResponseBody(responseBody,responseType,responseMimeType);internalState.responseBodyConsumed=true}return internalState.parsedResponseBody};var responseTextGetter=function(instance){var _a=getInternals(instance),responseBody=_a.responseBody,responseType=_a.responseType;if(!isTextResponse(responseType)){throw createDOMException("InvalidStateError: Failed to read the 'responseText' property from 'XMLHttpRequest': "+"The value is only accessible if the object's 'responseType' is '' or 'text'"+(" (was '"+responseType+"')"))}return responseBody||""};var responseTypeGetter=function(instance){return getInternals(instance).responseType};var responseTypeSetter=function(instance,responseType){getInternals(instance).responseType=responseType};var responseURLGetter=function(instance){return getInternals(instance).responseURL};var send=function(instance,body){var internalState=getInternals(instance);var requestSent=internalState.requestSent,requestUrl=internalState.requestUrl;if(!bbxhrPlugin){throw createError("Failed to execute 'send' on 'XMLHttpRequest': The plugin is not found")}if(instance.readyState!==ReadyState.Opened){throw createDOMException("InvalidStateError: Failed to execute 'send' on 'XMLHttpRequest': "+"The object's state must be OPENED")}if(requestSent){throw createDOMException("InvalidStateError: Failed to execute 'send' on 'XMLHttpRequest': "+"XMLHttpRequest must not be sending")}setRequestBodyAndContentType(instance,body).then((function(){shouldUsePlugin(requestUrl,(function(usePlugin){if(usePlugin){makeRequestUsingPlugin(instance)}else{makeRequestUsingNativeXHR(instance)}}))})).catch((function(error){throw error}));internalState.requestSent=true};var makeRequestUsingNativeXHR=function(instance){var internalState=getInternals(instance);var requestUrl=internalState.requestUrl;var onLoad=function(fileContent,headers){internalState.status=200;internalState.statusText="OK";internalState.readyState=ReadyState.Done;internalState.responseBody=fileContent;internalState.responseHeaders=headers;internalState.responseURL=requestUrl;eventDispatcher.dispatchReadyStateChangeEvent(instance);internalState.requestSent=false;eventDispatcher.dispatchLoadEvent(instance)};var onFail=function(){if(!internalState.requestSent){return}handleNetworkError(instance)};loadFile(requestUrl,onLoad,onFail)};var makeRequestUsingPlugin=function(instance){var internalState=getInternals(instance);var bodyAsByteArray=internalState.requestBody;var body=bodyAsByteArray?bytesToHexString(bodyAsByteArray):"";var headers=getAllRequestHeaders(instance);var method=internalState.requestMethod;var timeout=internalState.timeout||DEFAULT_PLUGIN_TIMEOUT;var url=internalState.requestUrl;bbxhrPlugin.makeRequest((function(pluginResponse){return handlePluginResponse(instance,pluginResponse)}),(function(pluginError){return handlePluginError(instance,pluginError)}),requestConfigToJSONString({body:body,headers:headers,method:method,timeout:timeout,url:url}));console.debug("[bbxhr] Request sent:",{body:body,headers:headers,method:method,timeout:timeout,url:url})};var setRequestHeader=function(instance,header,value,internalCall){if(internalCall===void 0){internalCall=false}var internalState=getInternals(instance);if(!internalCall&&(internalState.readyState!==ReadyState.Opened||internalState.requestSent)){throw createDOMException("InvalidStateError: Failed to execute 'setRequestHeader' on 'XMLHttpRequest': "+"The object's state must be OPENED")}header=String(header);value=String(value);if(!internalCall&&isForbiddenRequestHeader(header)){console.error('Refused to set unsafe header "'+header+'"');return}getInternals(instance).addRequestHeader(header,value)};var statusGetter=function(instance){return getInternals(instance).status};var statusTextGetter=function(instance){return getInternals(instance).statusText};var timeoutGetter=function(instance){return getInternals(instance).timeout};var timeoutSetter=function(instance,timeout){getInternals(instance).timeout=normalizeTimeout(timeout)};var uploadGetter=function(instance){return getInternals(instance).upload};var construct=function(instance){Object.defineProperty(instance,INTERNALS_KEY$2,{value:new XMLHttpRequestInternals})};return{abort:abort,construct:construct,getAllResponseHeaders:getAllResponseHeaders,getResponseHeader:getResponseHeader,makeRequestUsingNativeXHR:makeRequestUsingNativeXHR,makeRequestUsingPlugin:makeRequestUsingPlugin,onreadystatechangeGetter:onreadystatechangeGetter,onreadystatechangeSetter:onreadystatechangeSetter,open:open,overrideMimeType:overrideMimeType,readyStateGetter:readyStateGetter,responseGetter:responseGetter,responseTextGetter:responseTextGetter,responseTypeGetter:responseTypeGetter,responseTypeSetter:responseTypeSetter,responseURLGetter:responseURLGetter,send:send,setRequestHeader:setRequestHeader,statusGetter:statusGetter,statusTextGetter:statusTextGetter,timeoutGetter:timeoutGetter,timeoutSetter:timeoutSetter,uploadGetter:uploadGetter}};var makeXMLHttpRequest=function(bbxhrPlugin,domParser,urlParser,language){var implementation=createCustomXHRImplementation(bbxhrPlugin,domParser,urlParser,language);var XMLHttpRequest=function(_super){__extends(XMLHttpRequest,_super);function XMLHttpRequest(){var _this=_super.call(this)||this;implementation.construct(_this);return _this}Object.defineProperty(XMLHttpRequest.prototype,"onreadystatechange",{get:function(){return implementation.onreadystatechangeGetter(this)},set:function(listener){implementation.onreadystatechangeSetter(this,listener)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"readyState",{get:function(){return implementation.readyStateGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"response",{get:function(){return implementation.responseGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"responseText",{get:function(){return implementation.responseTextGetter(this)},set:function(responseText){},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"responseType",{get:function(){return implementation.responseTypeGetter(this)},set:function(responseType){implementation.responseTypeSetter(this,responseType)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"responseURL",{get:function(){return implementation.responseURLGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"responseXML",{get:function(){return null},set:function(responseXML){},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"status",{get:function(){return implementation.statusGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"statusText",{get:function(){return implementation.statusTextGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"timeout",{get:function(){return implementation.timeoutGetter(this)},set:function(timeout){implementation.timeoutSetter(this,timeout)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"upload",{get:function(){return implementation.uploadGetter(this)},enumerable:true,configurable:true});Object.defineProperty(XMLHttpRequest.prototype,"withCredentials",{get:function(){return true},set:function(withCredentials){},enumerable:true,configurable:true});XMLHttpRequest.prototype.abort=function(){return implementation.abort(this)};XMLHttpRequest.prototype.getAllResponseHeaders=function(){return implementation.getAllResponseHeaders(this)};XMLHttpRequest.prototype.getResponseHeader=function(header){return implementation.getResponseHeader(this,header)};XMLHttpRequest.prototype.open=function(requestMethod,requestUrl){if(arguments.length<2){throw createPlainTypeError("Failed to execute 'open' on 'XMLHttpRequest': 2 arguments required, but only "+arguments.length+" present.")}return implementation.open(this,requestMethod,requestUrl)};XMLHttpRequest.prototype.overrideMimeType=function(mime){return implementation.overrideMimeType(this,mime)};XMLHttpRequest.prototype.send=function(body){implementation.send(this,body)};XMLHttpRequest.prototype.setRequestHeader=function(header,value){if(arguments.length<2){throw createPlainTypeError("Failed to execute 'setRequestHeader' on 'XMLHttpRequest': "+("2 arguments required, but only "+arguments.length+" present."))}return implementation.setRequestHeader(this,header,value)};return XMLHttpRequest}(XMLHttpRequestEventTarget);var XMLHttpRequestProto=XMLHttpRequest.prototype;exposeConstant(XMLHttpRequest,READY_STATE_DONE,ReadyState.Done);exposeConstant(XMLHttpRequest,READY_STATE_HEADERS_RECEIVED,ReadyState.HeadersReceived);exposeConstant(XMLHttpRequest,READY_STATE_LOADING,ReadyState.Loading);exposeConstant(XMLHttpRequest,READY_STATE_OPENED,ReadyState.Opened);exposeConstant(XMLHttpRequest,READY_STATE_UNSENT,ReadyState.Unsent);exposeConstant(XMLHttpRequestProto,READY_STATE_DONE,ReadyState.Done);exposeConstant(XMLHttpRequestProto,READY_STATE_HEADERS_RECEIVED,ReadyState.HeadersReceived);exposeConstant(XMLHttpRequestProto,READY_STATE_LOADING,ReadyState.Loading);exposeConstant(XMLHttpRequestProto,READY_STATE_OPENED,ReadyState.Opened);exposeConstant(XMLHttpRequestProto,READY_STATE_UNSENT,ReadyState.Unsent);makeMembersEnumerable(XMLHttpRequestProto);makeMembersReadonly(XMLHttpRequestProto,["abort","open","send"]);applyNativeToString(XMLHttpRequestProto);return XMLHttpRequest};var enableBBXHR=function(bbxhrPlugin){var domParser=createDOMParser();var urlParser=createURLParser();var language=navigator.language;var XMLHttpRequest=makeXMLHttpRequest(bbxhrPlugin,domParser,urlParser,language);Object.assign(window,{XMLHttpRequest:XMLHttpRequest})};var enable=function(config,injectedNativePlugins){var bbxhrPlugin=injectedNativePlugins[BBXHRPluginName];if(!{}.hasOwnProperty.call(bbxhrPlugin,"isFileSchemeSupported")){bbxhrPlugin.isFileSchemeSupported=function(onSuccess,onError){setTimeout((function(){onSuccess("true")}),0)}}enableBBXHR(bbxhrPlugin)};exports.enable=enable})(this["@backbase/bbxhr"]=this["@backbase/bbxhr"]||{});
